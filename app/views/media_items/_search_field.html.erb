<script>
  $(function() {
    var types = $.map(<%= Type.all.to_json.html_safe %>, function (value, key) {
      return {
        id: value.id,
        name: value.name
      }
    });

    var getTypeNameByTypeId = function (id) {
      for (index = 0; index < types.length; ++index) {
        t = types[index];
        if(t.id == id) {
          return t.name;
        }
      }
      return "not found";
    }

    $("#search_field").autocomplete({
      delay: 200,
      minLength: 2,
      source: '<%= media_items_path(:json) %>',
      open: function(event, ui) {
        createLink = '<li border-top: 1px solid #ccc;"><%= link_to "Not found? Create a new one!", new_media_item_path %></li>';
        $('.ui-autocomplete').append(createLink);
      }
    }).data("ui-autocomplete")._renderItem = function (ul, item) {
          title = item.title;
          type = getTypeNameByTypeId(item.type_id)
          return $("<li></li>")
             .data("item.autocomplete", item)
             .append("<a>" + title + " (" + type + ")</a>")
             .appendTo(ul);
     };
  });
</script>
<div class="input-group">
  <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
  <%= text_field_tag :search, params[:search], :id => 'search_field', :class => "form-control", :placeholder => "Search" %>
</div>